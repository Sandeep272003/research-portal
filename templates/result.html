<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Result - AI Research Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #e6f0ff 0%, #b3d1ff 100%); 
            min-height: 100vh; 
            transition: background 0.5s ease; 
        }
        .dark-mode { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); 
            color: #e0f2fe; 
        }
        .dark-mode .navbar { background-color: #020617 !important; }
        .dark-mode .card { background: #1e293b; border-color: #334155; color: #e0f2fe; }
        .dark-mode .alert { background: #334155; color: #e0f2fe; }
        .dark-mode .table { background: #1e293b; color: #e0f2fe; }
        .dark-mode .table-bordered { border-color: #475569; }
        .navbar { 
            background-color: #1d4ed8 !important; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            transition: background 0.5s ease; 
        }
        .tone.optimistic { color: #22c55e; font-weight: bold; }
        .tone.cautious { color: #eab308; font-weight: bold; }
        .tone.pessimistic { color: #ef4444; font-weight: bold; }
        .tone.neutral { color: #6b7280; font-weight: bold; }
        .card { 
            transition: transform 0.4s ease; 
            box-shadow: 0 6px 24px rgba(0,0,0,0.08); 
            border-radius: 16px; 
        }
        .card:hover { 
            transform: translateY(-8px); 
        }
        .tooltip-inner { background: #1d4ed8; color: white; border-radius: 8px; }
        .table { border-radius: 12px; overflow: hidden; }
        .table th { background: #eff6ff; font-weight: 600; }
        .dark-mode .table th { background: #334155; }
        .btn-success { 
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); 
            border: none; 
            border-radius: 50px; 
            padding: 12px 32px; 
            font-weight: 600; 
        }
        .btn-success:hover { 
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(34,197,94,0.3); 
        }
        .btn-outline-primary { 
            border-color: #1d4ed8; 
            color: #1d4ed8; 
            border-radius: 50px; 
            padding: 12px 32px; 
            font-weight: 600; 
        }
        .btn-outline-primary:hover { 
            background: #1d4ed8; 
            color: white; 
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-robot me-2"></i>AI Research Portal</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/about">About</a>
                <button id="darkToggle" class="btn btn-outline-light ms-3"><i class="fas fa-moon"></i></button>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        {% if error %}
            <div class="alert alert-danger text-center" role="alert">
                <h4><i class="fas fa-exclamation-triangle me-2"></i>⚠️ {{ error }}</h4>
                <a href="/" class="btn btn-primary mt-3">Try Again</a>
            </div>
        {% else %}
            <div class="card shadow-lg">
                <div class="card-body p-5">
                    {% if tool == "financial_extraction" %}
                        <h2 class="card-title text-center mb-4"><i class="fas fa-file-excel me-2 text-success"></i>Financial Statement Extraction</h2>
                        <div class="row text-center mb-4 bg-light p-3 rounded shadow-sm">
                            <div class="col" data-bs-toggle="tooltip" title="Detected currency from document"><strong>Currency:</strong> {{ metadata.currency }}</div>
                            <div class="col" data-bs-toggle="tooltip" title="Detected units (e.g., millions)"><strong>Units:</strong> {{ metadata.units }}</div>
                            <div class="col" data-bs-toggle="tooltip" title="Extracted fiscal periods"><strong>Periods:</strong> {{ metadata.periods|join(", ") }}</div>
                        </div>
                        <div class="table-responsive">
                            {{ table_html|safe }}
                        </div>
                        <div class="text-center mt-4">
                            <a href="/download/{{ download_file }}" class="btn btn-success btn-lg"><i class="fas fa-download me-2"></i>Download Excel File</a>
                        </div>
                        <p class="text-muted text-center mt-3"><small data-bs-toggle="tooltip" title="For analyst review">Missing or ambiguous items are marked as N/A</small></p>

                    {% else %}
                        <h2 class="card-title text-center mb-4"><i class="fas fa-chart-line me-2 text-primary"></i>Earnings Call / Management Commentary Summary</h2>
                        <div class="row text-center mb-5 bg-light p-3 rounded shadow-sm">
                            <div class="col"><strong>Tone:</strong> <span class="tone {{ summary.tone }}">{{ summary.tone|capitalize }}</span></div>
                            <div class="col"><strong>Confidence:</strong> {{ summary.confidence|capitalize }}</div>
                        </div>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5><i class="fas fa-thumbs-up me-2 text-success"></i>Key Positives</h5>
                                        <ul>
                                            {% for point in summary.key_positives %}
                                                <li>{{ point }}</li>
                                            {% else %}
                                                <li>None mentioned</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Key Concerns/Challenges</h5>
                                        <ul>
                                            {% for point in summary.key_concerns %}
                                                <li>{{ point }}</li>
                                            {% else %}
                                                <li>None mentioned</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="fas fa-forward me-2 text-info"></i>Forward Guidance</h5>
                                        <p>{{ summary.forward_guidance }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="fas fa-tachometer-alt me-2 text-primary"></i>Capacity Utilization Trends</h5>
                                        <p>{{ summary.capacity_utilization }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="fas fa-seedling me-2 text-success"></i>New Growth Initiatives</h5>
                                        <ul>
                                            {% for init in summary.growth_initiatives %}
                                                <li>{{ init }}</li>
                                            {% else %}
                                                <li>Not mentioned</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="text-center mt-5">
                        <a href="/" class="btn btn-outline-primary btn-lg"><i class="fas fa-redo me-2"></i>Analyze Another Document</a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <script>
        const toggle = document.getElementById('darkToggle');
        toggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            toggle.innerHTML = document.body.classList.contains('dark-mode') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });
        // Enable tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
    </script>
</body>
</html>